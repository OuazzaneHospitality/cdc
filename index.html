<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cahier des Charges Architectural ‚Äî TACHTA Hotel & Resort</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-bg: #FAF9F7;
            --color-bg-alt: #F3F1ED;
            --color-text: #2C2825;
            --color-text-light: #6B6560;
            --color-accent: #8B7355;
            --color-accent-light: #C4B5A0;
            --color-gold: #B8996F;
            --color-white: #FFFFFF;
            --color-border: #E5E2DC;
            --color-success: #4CAF50;
            --color-warning: #FF9800;
            --color-error: #f44336;
            --color-info: #2196F3;
            --font-display: 'Cormorant Garamond', Georgia, serif;
            --font-body: 'Jost', 'Helvetica Neue', sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            font-weight: 300;
            font-size: 16px;
            line-height: 1.8;
            color: var(--color-text);
            background: var(--color-bg);
            -webkit-font-smoothing: antialiased;
        }

        /* Print Styles */
        @media print {
            body { background: white; font-size: 11pt; }
            .no-print, .sidebar, .floating-nav, .toolbar, .toast-container, .modal-overlay { display: none !important; }
            .main-content { margin-left: 0 !important; padding: 20px !important; margin-top: 0 !important; }
            section { page-break-inside: avoid; break-inside: avoid; }
            h2 { page-break-after: avoid; }
            .cover-page { height: auto; min-height: 100vh; }
            [contenteditable] { border: none !important; outline: none !important; }
        }

        /* Toolbar */
        .toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--color-white);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .toolbar-logo {
            font-family: var(--font-display);
            font-size: 20px;
            font-weight: 500;
            color: var(--color-accent);
            letter-spacing: 0.05em;
        }

        .toolbar-title {
            font-size: 13px;
            color: var(--color-text-light);
            display: none;
        }

        @media (min-width: 768px) {
            .toolbar-title { display: block; }
        }

        .toolbar-center {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            background: var(--color-bg-alt);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-text-light);
        }

        .status-dot.online { background: var(--color-success); }
        .status-dot.syncing { background: var(--color-warning); animation: pulse 1s infinite; }
        .status-dot.offline { background: var(--color-error); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .user-count {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--color-text-light);
        }

        .edit-mode-badge {
            display: none;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 6px 12px;
            border-radius: 4px;
            background: var(--color-accent);
            color: var(--color-white);
        }

        .edit-mode-badge.active { display: flex; }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-btn {
            padding: 8px 16px;
            font-family: var(--font-body);
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--color-border);
            background: var(--color-white);
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            border-radius: 4px;
        }

        .toolbar-btn:hover {
            background: var(--color-bg-alt);
            border-color: var(--color-accent-light);
        }

        .toolbar-btn.primary {
            background: var(--color-accent);
            border-color: var(--color-accent);
            color: var(--color-white);
        }

        .toolbar-btn.primary:hover {
            background: var(--color-text);
            border-color: var(--color-text);
        }

        .toolbar-btn.danger {
            color: var(--color-error);
        }

        .toolbar-btn.danger:hover {
            background: var(--color-error);
            border-color: var(--color-error);
            color: white;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            padding: 12px 20px;
            background: var(--color-text);
            color: white;
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast.success { background: var(--color-success); }
        .toast.warning { background: var(--color-warning); color: var(--color-text); }
        .toast.error { background: var(--color-error); }
        .toast.info { background: var(--color-info); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .toast.hiding {
            animation: slideOut 0.3s ease forwards;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--color-white);
            border-radius: 12px;
            max-width: 450px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 24px 24px 0;
            text-align: center;
        }

        .modal-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 16px;
            background: var(--color-bg-alt);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: var(--color-text-light);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-input-group {
            margin-bottom: 16px;
        }

        .modal-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-text-light);
            margin-bottom: 8px;
        }

        .modal-input {
            width: 100%;
            padding: 12px 16px;
            font-family: var(--font-body);
            font-size: 14px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            transition: all 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--color-accent);
            background: var(--color-white);
        }

        .modal-input.error {
            border-color: var(--color-error);
        }

        .modal-error {
            font-size: 12px;
            color: var(--color-error);
            margin-top: 6px;
            display: none;
        }

        .modal-error.visible { display: block; }

        .modal-footer {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px 20px;
            font-family: var(--font-body);
            font-size: 14px;
            font-weight: 500;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn.primary {
            background: var(--color-accent);
            border-color: var(--color-accent);
            color: var(--color-white);
        }

        .modal-btn.primary:hover {
            background: var(--color-text);
            border-color: var(--color-text);
        }

        .modal-btn.secondary {
            background: var(--color-white);
            color: var(--color-text);
        }

        .modal-btn.secondary:hover {
            background: var(--color-bg-alt);
        }

        /* Editable Content Styles */
        [data-field] {
            transition: all 0.2s ease;
            position: relative;
        }

        body.edit-mode [data-field] {
            cursor: text;
        }

        body.edit-mode [data-field]:hover {
            background: rgba(139, 115, 85, 0.05);
        }

        body.edit-mode [data-field]:focus {
            outline: none;
            background: rgba(139, 115, 85, 0.08);
            box-shadow: inset 0 0 0 2px var(--color-accent-light);
        }

        [data-field].remote-editing {
            box-shadow: inset 0 0 0 2px var(--color-info) !important;
            background: rgba(33, 150, 243, 0.05) !important;
        }

        [data-field].remote-editing::after {
            content: '‚úèÔ∏è En cours d\'√©dition...';
            position: absolute;
            top: -24px;
            left: 0;
            font-size: 10px;
            background: var(--color-info);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            white-space: nowrap;
        }

        /* Last Sync Info */
        .sync-info {
            position: fixed;
            bottom: 24px;
            left: 24px;
            font-size: 11px;
            color: var(--color-text-light);
            background: var(--color-white);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            z-index: 100;
        }

        /* Cover Page */
        .cover-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(180deg, var(--color-bg) 0%, var(--color-bg-alt) 100%);
            position: relative;
            padding: 100px 40px 60px;
            margin-top: 60px;
        }

        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 115, 85, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(184, 153, 111, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .cover-logo {
            width: 80px;
            height: 80px;
            border: 2px solid var(--color-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 60px;
            position: relative;
        }

        .cover-logo span {
            font-family: var(--font-display);
            font-size: 32px;
            font-weight: 300;
            color: var(--color-accent);
            letter-spacing: 0.1em;
        }

        .cover-subtitle {
            font-family: var(--font-body);
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: var(--color-accent);
            margin-bottom: 24px;
        }

        .cover-title {
            font-family: var(--font-display);
            font-size: clamp(36px, 6vw, 64px);
            font-weight: 300;
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .cover-title em {
            font-style: italic;
            color: var(--color-accent);
        }

        .cover-project {
            font-family: var(--font-display);
            font-size: clamp(24px, 4vw, 40px);
            font-weight: 400;
            color: var(--color-gold);
            margin-bottom: 60px;
            letter-spacing: 0.05em;
        }

        .cover-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            justify-content: center;
            font-size: 13px;
            color: var(--color-text-light);
            letter-spacing: 0.05em;
        }

        .cover-meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cover-meta-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-accent-light);
        }

        .cover-stars {
            font-size: 18px;
            letter-spacing: 0.2em;
            color: var(--color-gold);
            margin-top: 40px;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--color-accent-light);
            font-size: 10px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(8px); }
        }

        .scroll-indicator svg {
            width: 20px;
            height: 20px;
            stroke: var(--color-accent-light);
        }

        /* Main Content */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 80px 40px 120px;
        }

        /* Section Styles */
        section {
            margin-bottom: 100px;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s ease forwards;
        }

        section:nth-child(1) { animation-delay: 0.1s; }
        section:nth-child(2) { animation-delay: 0.15s; }
        section:nth-child(3) { animation-delay: 0.2s; }
        section:nth-child(4) { animation-delay: 0.25s; }
        section:nth-child(5) { animation-delay: 0.3s; }
        section:nth-child(6) { animation-delay: 0.35s; }
        section:nth-child(7) { animation-delay: 0.4s; }
        section:nth-child(8) { animation-delay: 0.45s; }
        section:nth-child(9) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-number {
            font-family: var(--font-display);
            font-size: 14px;
            font-weight: 400;
            color: var(--color-accent-light);
            letter-spacing: 0.2em;
            margin-bottom: 12px;
            display: block;
        }

        h2 {
            font-family: var(--font-display);
            font-size: clamp(28px, 4vw, 38px);
            font-weight: 400;
            color: var(--color-text);
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--color-border);
            letter-spacing: -0.01em;
        }

        h3 {
            font-family: var(--font-display);
            font-size: 22px;
            font-weight: 500;
            color: var(--color-text);
            margin: 40px 0 20px;
            letter-spacing: 0.01em;
        }

        h4 {
            font-family: var(--font-body);
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-accent);
            margin: 30px 0 16px;
        }

        p {
            margin-bottom: 20px;
            color: var(--color-text);
        }

        .lead {
            font-size: 18px;
            line-height: 1.9;
            color: var(--color-text-light);
            font-weight: 300;
        }

        /* Quote Block */
        .quote-block {
            background: linear-gradient(135deg, var(--color-bg-alt) 0%, var(--color-white) 100%);
            border-left: 3px solid var(--color-gold);
            padding: 30px 35px;
            margin: 40px 0;
            position: relative;
        }

        .quote-block::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 15px;
            font-family: var(--font-display);
            font-size: 60px;
            color: var(--color-accent-light);
            opacity: 0.3;
            line-height: 1;
        }

        .quote-block p {
            font-family: var(--font-display);
            font-size: 20px;
            font-style: italic;
            line-height: 1.7;
            color: var(--color-text);
            margin: 0;
        }

        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin: 30px 0;
        }

        .data-card {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            padding: 28px;
            transition: all 0.3s ease;
        }

        .data-card:hover {
            border-color: var(--color-accent-light);
            box-shadow: 0 8px 30px rgba(139, 115, 85, 0.08);
        }

        .data-card-value {
            font-family: var(--font-display);
            font-size: 32px;
            font-weight: 400;
            color: var(--color-accent);
            line-height: 1;
            margin-bottom: 8px;
        }

        .data-card-label {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-text-light);
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin: 30px 0;
            border: 1px solid var(--color-border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: var(--color-bg-alt);
        }

        th {
            font-weight: 500;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.1em;
            color: var(--color-text-light);
            text-align: left;
            padding: 16px 20px;
            border-bottom: 1px solid var(--color-border);
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--color-border);
            vertical-align: top;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(139, 115, 85, 0.02);
        }

        /* Values Grid */
        .values-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0;
            margin: 40px 0;
            border: 1px solid var(--color-border);
        }

        @media (max-width: 768px) {
            .values-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .value-item:nth-child(5) {
                grid-column: span 2;
            }
        }

        .value-item {
            text-align: center;
            padding: 40px 20px;
            border-right: 1px solid var(--color-border);
            background: var(--color-white);
            transition: all 0.3s ease;
        }

        .value-item:last-child {
            border-right: none;
        }

        .value-item:hover {
            background: var(--color-bg-alt);
        }

        .value-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-accent-light);
            border-radius: 50%;
        }

        .value-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--color-accent);
        }

        .value-item h5 {
            font-family: var(--font-display);
            font-size: 16px;
            font-weight: 500;
            color: var(--color-text);
            margin: 0;
        }

        /* Spec List */
        .spec-list {
            list-style: none;
            margin: 20px 0;
        }

        .spec-list li {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
        }

        .spec-list li:last-child {
            border-bottom: none;
        }

        .spec-label {
            color: var(--color-text-light);
        }

        .spec-value {
            font-weight: 500;
            color: var(--color-text);
            text-align: right;
        }

        /* Info Box */
        .info-box {
            background: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            padding: 30px;
            margin: 30px 0;
        }

        .info-box h5 {
            font-family: var(--font-body);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-accent);
            margin-bottom: 16px;
        }

        .info-box p {
            margin-bottom: 12px;
            font-size: 14px;
        }

        .info-box p:last-child {
            margin-bottom: 0;
        }

        /* Timeline */
        .timeline {
            position: relative;
            margin: 40px 0;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            bottom: 8px;
            width: 1px;
            background: var(--color-border);
        }

        .timeline-item {
            position: relative;
            padding: 0 0 40px 30px;
        }

        .timeline-item:last-child {
            padding-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 8px;
            width: 9px;
            height: 9px;
            background: var(--color-white);
            border: 2px solid var(--color-accent);
            border-radius: 50%;
        }

        .timeline-phase {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-accent);
            margin-bottom: 8px;
        }

        .timeline-title {
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .timeline-desc {
            font-size: 14px;
            color: var(--color-text-light);
            line-height: 1.7;
        }

        /* Footer */
        .document-footer {
            text-align: center;
            padding: 60px 40px;
            border-top: 1px solid var(--color-border);
            margin-top: 80px;
        }

        .footer-logo {
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 400;
            color: var(--color-accent);
            letter-spacing: 0.1em;
            margin-bottom: 20px;
        }

        .footer-text {
            font-size: 12px;
            color: var(--color-text-light);
            letter-spacing: 0.05em;
        }

        .footer-text a {
            color: var(--color-accent);
            text-decoration: none;
        }

        .confidential-badge {
            display: inline-block;
            margin-top: 30px;
            padding: 8px 20px;
            border: 1px solid var(--color-border);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--color-text-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 60px 24px 80px;
            }

            .cover-page {
                padding: 100px 24px 60px;
            }

            .toolbar {
                padding: 0 12px;
            }

            .toolbar-btn span {
                display: none;
            }

            .connection-status span {
                display: none;
            }
        }
    </style>
</head>
<body>

    <!-- Toolbar -->
    <div class="toolbar no-print">
        <div class="toolbar-left">
            <div class="toolbar-logo">TACHTA</div>
            <div class="toolbar-title">Cahier des Charges Architectural</div>
        </div>
        
        <div class="toolbar-center">
            <div class="connection-status" id="connectionStatus">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connexion...</span>
            </div>
            <div class="user-count" id="userCount">
                <span>üë•</span>
                <span id="userCountText">-</span>
            </div>
            <div class="edit-mode-badge" id="editModeBadge">
                <span>‚úèÔ∏è</span>
                <span>Mode √âdition</span>
            </div>
        </div>
        
        <div class="toolbar-right">
            <button class="toolbar-btn" onclick="downloadPDF()" title="T√©l√©charger PDF">
                <span>üì•</span>
                <span>PDF</span>
            </button>
            <button class="toolbar-btn" onclick="downloadHTML()" title="T√©l√©charger HTML">
                <span>üìÑ</span>
                <span>HTML</span>
            </button>
            <button class="toolbar-btn danger" onclick="confirmRestore()" id="restoreBtn" style="display:none;" title="Restaurer version originale">
                <span>üîÑ</span>
                <span>Restaurer</span>
            </button>
            <button class="toolbar-btn primary" onclick="showPasswordModal()" id="editBtn" title="Mode √©dition">
                <span>üîê</span>
                <span>√âditer</span>
            </button>
            <button class="toolbar-btn" onclick="exitEditMode()" id="exitEditBtn" style="display:none;" title="Quitter le mode √©dition">
                <span>‚úï</span>
                <span>Quitter</span>
            </button>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üîê</div>
                <h3 class="modal-title">Mode √âdition</h3>
                <p class="modal-subtitle">Entrez le mot de passe pour modifier le document</p>
            </div>
            <div class="modal-body">
                <div class="modal-input-group">
                    <label class="modal-label">Mot de passe</label>
                    <input type="password" class="modal-input" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="handlePasswordKeypress(event)">
                    <p class="modal-error" id="passwordError">Mot de passe incorrect</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="hidePasswordModal()">Annuler</button>
                <button class="modal-btn primary" onclick="checkPassword()">Acc√©der</button>
            </div>
        </div>
    </div>

    <!-- Restore Confirmation Modal -->
    <div class="modal-overlay" id="restoreModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">‚ö†Ô∏è</div>
                <h3 class="modal-title">Restaurer Version Originale</h3>
                <p class="modal-subtitle">Cette action remplacera toutes les modifications par le contenu original. Tous les utilisateurs connect√©s verront ce changement.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="hideRestoreModal()">Annuler</button>
                <button class="modal-btn primary" onclick="restoreOriginalVersion()">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Sync Info -->
    <div class="sync-info no-print" id="syncInfo">
        Derni√®re synchro : <span id="lastSyncTime">-</span>
    </div>

    <!-- Cover Page -->
    <header class="cover-page" id="documentContent">
        <div class="cover-logo">
            <span>T</span>
        </div>
        <p class="cover-subtitle">Cahier des Charges Architectural</p>
        <h1 class="cover-title">TACHTA <em>Hotel & Resort</em></h1>
        <p class="cover-project" data-field="cover_location">Ouazzane, Maroc</p>
        
        <div class="cover-meta">
            <div class="cover-meta-item">
                <span class="cover-meta-label">Classification</span>
                <span data-field="cover_classification">Boutique H√¥tel 5‚òÖ Luxe</span>
            </div>
            <div class="cover-meta-item">
                <span class="cover-meta-label">Cadre l√©gal</span>
                <span data-field="cover_cadre">RIA ‚Äî R√©sidences Immobili√®res Adoss√©es</span>
            </div>
            <div class="cover-meta-item">
                <span class="cover-meta-label">Ma√Ætre d'Ouvrage</span>
                <span data-field="cover_maitre_ouvrage">Ouazzane Hospitality SARL</span>
            </div>
            <div class="cover-meta-item">
                <span class="cover-meta-label">Version</span>
                <span data-field="cover_version">1.0 ‚Äî Janvier 2026</span>
            </div>
        </div>

        <div class="cover-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>

        <div class="scroll-indicator no-print">
            <span>D√©couvrir</span>
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                <path d="M12 5v14M5 12l7 7 7-7"/>
            </svg>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Section 1: Pr√©ambule -->
        <section id="preambule">
            <span class="section-number">Section 01</span>
            <h2 data-field="section1_title">Pr√©ambule ‚Äî Vision du Ma√Ætre d'Ouvrage</h2>
            
            <p class="lead" data-field="section1_lead">Le projet TACHTA Hotel & Resort incarne une vision ambitieuse : cr√©er un havre de paix o√π le luxe √©pur√© rencontre l'authenticit√© marocaine, dans un √©crin naturel surplombant la ville historique de Ouazzane.</p>

            <div class="quote-block">
                <p data-field="section1_quote">Un investissement-plaisir alliant rentabilit√©, libert√© d'usage et prestations haut de gamme, ancr√© dans les valeurs de puret√©, d'authenticit√© et de chaleur humaine.</p>
            </div>

            <h3 data-field="section1_h3_1">Philosophie du Projet</h3>
            
            <p data-field="section1_para1">TACHTA ‚Äî qui signifie "pluie" en dialecte local ‚Äî symbolise la renaissance et la fertilit√©. Ce projet se veut catalyseur du d√©veloppement touristique de Ouazzane, destination spirituelle, culturelle et sportive √† fort potentiel.</p>

            <p data-field="section1_para2">Notre vision architecturale s'inspire du luxe nordique et su√©dois : des lignes pures, des mat√©riaux nobles, une int√©gration harmonieuse dans le paysage, tout en c√©l√©brant l'artisanat et le patrimoine marocain. Le r√©sultat : un lieu chaleureux et raffin√© o√π chaque d√©tail raconte une histoire.</p>

            <h4>Objectifs Strat√©giques</h4>

            <div class="data-grid">
                <div class="data-card">
                    <div class="data-card-value" data-field="kpi_investissement">160M</div>
                    <div class="data-card-label">DHS d'investissement total</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="kpi_cles">35</div>
                    <div class="data-card-label">Cl√©s h√¥teli√®res</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="kpi_unites">116</div>
                    <div class="data-card-label">Unit√©s r√©sidentielles RIA</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="kpi_rendement">6%</div>
                    <div class="data-card-label">Rendement annuel net garanti</div>
                </div>
            </div>
        </section>

        <!-- Section 2: Contexte & Enjeux -->
        <section id="contexte">
            <span class="section-number">Section 02</span>
            <h2 data-field="section2_title">Contexte & Enjeux</h2>

            <h3 data-field="section2_h3_1">Le Site ‚Äî Ouazzane</h3>
            
            <p data-field="section2_para1">Nich√©e au c≈ìur du Rif occidental, Ouazzane occupe une position strat√©gique sur le circuit touristique reliant Tanger, Chefchaouen et F√®s. La ville, surnomm√©e "la ville sainte" ou "Dar Dmana" (maison de la garantie), poss√®de un riche patrimoine spirituel et artisanal encore largement pr√©serv√© du tourisme de masse.</p>

            <div class="info-box">
                <h5>Positionnement g√©ographique</h5>
                <p data-field="section2_geo1">√Ä 1h30 de Tanger, 1h de Chefchaouen, 2h de F√®s ‚Äî carrefour id√©al sur le circuit nord du Maroc.</p>
                <p data-field="section2_geo2">Altitude : 300-400m ‚Äî climat temp√©r√©, id√©al pour un tourisme toute saison.</p>
                <p data-field="section2_geo3">Terrain du projet : 7 639 m¬≤ sur Titre Foncier 30810/30, surplombant la ville et la for√™t.</p>
            </div>

            <h3 data-field="section2_h3_2">Opportunit√©s</h3>
            
            <p data-field="section2_para2">L'absence d'offre h√¥teli√®re haut de gamme sur le territoire repr√©sente une opportunit√© unique de positionnement. Le projet b√©n√©ficie du soutien des autorit√©s locales dans le cadre d'un contrat-programme de d√©veloppement touristique 2026-2030.</p>

            <h4>March√©s cibles</h4>
            
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Segment</th>
                            <th>Profil</th>
                            <th>Besoins cl√©s</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong data-field="marche1_segment">Marocains du Monde</strong></td>
                            <td data-field="marche1_profil">Diaspora originaire de Ouazzane (Europe, Isra√´l)</td>
                            <td data-field="marche1_besoins">Pied-√†-terre familial, retour aux sources, investissement patrimonial</td>
                        </tr>
                        <tr>
                            <td><strong data-field="marche2_segment">Urbains CSP+</strong></td>
                            <td data-field="marche2_profil">Couples/retrait√©s de Casablanca et Rabat</td>
                            <td data-field="marche2_besoins">Escapade nature, authenticit√©, cadre familial</td>
                        </tr>
                        <tr>
                            <td><strong data-field="marche3_segment">Tourisme international</strong></td>
                            <td data-field="marche3_profil">Circuit Tanger-Chefchaouen-F√®s</td>
                            <td data-field="marche3_besoins">Exp√©rience culturelle, spiritualit√©, nature</td>
                        </tr>
                        <tr>
                            <td><strong data-field="marche4_segment">MICE & Corporate</strong></td>
                            <td data-field="marche4_profil">Entreprises, s√©minaires, team-building</td>
                            <td data-field="marche4_besoins">Cadre inspirant, √©quipements, accessibilit√©</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 data-field="section2_h3_3">Contraintes du Site</h3>
            
            <p data-field="section2_para3">La topographie en pente du terrain, si elle offre des vues panoramiques exceptionnelles, impose une r√©flexion approfondie sur l'implantation des b√¢timents, la gestion des acc√®s et l'int√©gration paysag√®re. Le respect des normes de classement 5 √©toiles et du cadre r√©glementaire RIA (Arr√™t√© n¬∞ 836-24) constitue un imp√©ratif absolu.</p>
        </section>

        <!-- Section 3: Programme Fonctionnel -->
        <section id="programme">
            <span class="section-number">Section 03</span>
            <h2 data-field="section3_title">Programme Fonctionnel D√©taill√©</h2>

            <h3 data-field="section3_h3_1">A. Boutique H√¥tel 5‚òÖ Luxe</h3>
            
            <div class="data-grid">
                <div class="data-card">
                    <div class="data-card-value" data-field="hotel_shob">3 874</div>
                    <div class="data-card-label">m¬≤ SHOB/SHON</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="hotel_ratio">1.72:1</div>
                    <div class="data-card-label">Ratio √©quipements/h√©bergement</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="hotel_parties_communes">45%</div>
                    <div class="data-card-label">Parties communes</div>
                </div>
            </div>

            <h4>H√©bergement ‚Äî 950 m¬≤</h4>
            
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Typologie</th>
                            <th>Quantit√©</th>
                            <th>Surface unitaire</th>
                            <th>Surface totale</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-field="chambre_type1">Chambres Deluxe</td>
                            <td data-field="chambre_qty1">30</td>
                            <td data-field="chambre_surf1">25 m¬≤</td>
                            <td data-field="chambre_total1">750 m¬≤</td>
                        </tr>
                        <tr>
                            <td data-field="chambre_type2">Suites</td>
                            <td data-field="chambre_qty2">5</td>
                            <td data-field="chambre_surf2">40 m¬≤</td>
                            <td data-field="chambre_total2">200 m¬≤</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>√âquipements & Services ‚Äî 1 721 m¬≤</h4>

            <ul class="spec-list">
                <li>
                    <span class="spec-label" data-field="equip_label1">Piscine √† d√©bordement</span>
                    <span class="spec-value" data-field="equip_value1">250 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label2">Terrasse solarium</span>
                    <span class="spec-value" data-field="equip_value2">500 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label3">SPA & Salon de coiffure</span>
                    <span class="spec-value" data-field="equip_value3">450 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label4">Restaurant & Lounge Bar</span>
                    <span class="spec-value" data-field="equip_value4">221 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label5">Salle √©v√©nementielle / Ballroom</span>
                    <span class="spec-value" data-field="equip_value5">300 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label6">Salle de fitness</span>
                    <span class="spec-value" data-field="equip_value6">Selon programme</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label7">Boutiques</span>
                    <span class="spec-value" data-field="equip_value7">Selon programme</span>
                </li>
                <li>
                    <span class="spec-label" data-field="equip_label8">Ascenseur panoramique</span>
                    <span class="spec-value" data-field="equip_value8">Traversant, vue ville & for√™t</span>
                </li>
            </ul>

            <h4>Parties Communes ‚Äî 1 202 m¬≤ (45%)</h4>
            
            <p data-field="section3_para1">Les parties communes incluent : r√©ception et lobby, circulations, locaux techniques, back-office, vestiaires personnel, stockage et espaces de service.</p>

            <h3 data-field="section3_h3_2">B. R√©sidences H√¥teli√®res RIA 5‚òÖ</h3>
            
            <div class="data-grid">
                <div class="data-card">
                    <div class="data-card-value" data-field="ria_shob">9 120</div>
                    <div class="data-card-label">m¬≤ SHOB</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="ria_shon">7 600</div>
                    <div class="data-card-label">m¬≤ SHON</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value" data-field="ria_unites">116</div>
                    <div class="data-card-label">Unit√©s totales</div>
                </div>
            </div>

            <h4>R√©partition des Typologies</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Typologie</th>
                            <th>Quantit√©</th>
                            <th>Surface</th>
                            <th>Caract√©ristiques</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong data-field="typo1_nom">F1 Pied-√†-terre</strong></td>
                            <td data-field="typo1_qty">40</td>
                            <td data-field="typo1_surf">40 m¬≤</td>
                            <td data-field="typo1_carac">Studio optimis√©, id√©al investissement</td>
                        </tr>
                        <tr>
                            <td><strong data-field="typo2_nom">F2 Traversant</strong></td>
                            <td data-field="typo2_qty">40</td>
                            <td data-field="typo2_surf">60 m¬≤</td>
                            <td data-field="typo2_carac">Double orientation, luminosit√© maximale</td>
                        </tr>
                        <tr>
                            <td><strong data-field="typo3_nom">F3 Spacieux</strong></td>
                            <td data-field="typo3_qty">30</td>
                            <td data-field="typo3_surf">90 m¬≤</td>
                            <td data-field="typo3_carac">Famille, terrasse g√©n√©reuse</td>
                        </tr>
                        <tr>
                            <td><strong data-field="typo4_nom">Penthouse Duplex</strong></td>
                            <td data-field="typo4_qty">6</td>
                            <td data-field="typo4_surf">150 m¬≤</td>
                            <td data-field="typo4_carac">Prestige, rooftop privatif</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="info-box">
                <h5>Programme de Gestion H√¥teli√®re</h5>
                <p data-field="section3_gestion">Vendus meubl√©s, les appartements sont g√©r√©s int√©gralement par le Boutique Hotel avec un rendement annuel garanti de 6% net (gestion locative, entretien, nettoyage, s√©curit√©, syndic inclus) et jusqu'√† 50 jours d'occupation personnelle par an.</p>
            </div>
        </section>

        <!-- Section 4: Parti Architectural -->
        <section id="parti-architectural">
            <span class="section-number">Section 04</span>
            <h2 data-field="section4_title">Parti Architectural</h2>

            <h3 data-field="section4_h3_1">Les Valeurs Fondamentales</h3>
            
            <p data-field="section4_para1">L'architecture du projet doit incarner cinq valeurs essentielles qui guideront chaque d√©cision conceptuelle :</p>

            <div class="values-grid">
                <div class="value-item">
                    <div class="value-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                    </div>
                    <h5 data-field="valeur1">Puret√©</h5>
                </div>
                <div class="value-item">
                    <div class="value-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <h5 data-field="valeur2">Praticit√©</h5>
                </div>
                <div class="value-item">
                    <div class="value-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        </svg>
                    </div>
                    <h5 data-field="valeur3">Sport</h5>
                </div>
                <div class="value-item">
                    <div class="value-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <h5 data-field="valeur4">Authenticit√©</h5>
                </div>
                <div class="value-item">
                    <div class="value-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                    </div>
                    <h5 data-field="valeur5">Famille</h5>
                </div>
            </div>

            <h3 data-field="section4_h3_2">Ligne Directrice : Luxe Nordique Chaleureux</h3>
            
            <p data-field="section4_para2">L'inspiration architecturale puise dans le minimalisme scandinave tout en l'enrichissant de la chaleur m√©diterran√©enne. Le r√©sultat recherch√© est un luxe discret, o√π la sophistication se r√©v√®le dans la qualit√© des mat√©riaux et la ma√Ætrise des proportions plut√¥t que dans l'ostentation.</p>

            <h4>Principes de conception</h4>
            
            <p data-field="section4_para3"><strong>Volum√©trie :</strong> Des volumes √©pur√©s aux lignes horizontales affirm√©es, s'√©tageant harmonieusement dans la pente pour √©pouser la topographie naturelle. Chaque b√¢timent doit maximiser les vues panoramiques sur la ville et la for√™t environnante.</p>

            <p data-field="section4_para4"><strong>Int√©gration paysag√®re :</strong> L'architecture doit √©merger du site comme une √©vidence. Les toitures v√©g√©talis√©es, les murs de sout√®nement en pierre locale, et la pr√©servation maximale de la v√©g√©tation existante sont attendus.</p>

            <p data-field="section4_para5"><strong>Lumi√®re naturelle :</strong> Priorit√© aux grandes ouvertures vitr√©es orient√©es pour capter la lumi√®re tout en pr√©servant l'intimit√©. Les appartements traversants (F2) doivent offrir une double orientation.</p>

            <h4>Palette de mat√©riaux</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Cat√©gorie</th>
                            <th>Mat√©riaux pr√©conis√©s</th>
                            <th>Application</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong data-field="mat1_cat">Pierre</strong></td>
                            <td data-field="mat1_mat">Pierre locale de Ouazzane, travertin</td>
                            <td data-field="mat1_app">Soubassements, murs d'accentuation, terrasses</td>
                        </tr>
                        <tr>
                            <td><strong data-field="mat2_cat">Bois</strong></td>
                            <td data-field="mat2_mat">C√®dre du Maroc, ch√™ne europ√©en</td>
                            <td data-field="mat2_app">Menuiseries, bardages, mobilier int√©gr√©</td>
                        </tr>
                        <tr>
                            <td><strong data-field="mat3_cat">M√©tal</strong></td>
                            <td data-field="mat3_mat">Acier corten, laiton bross√©</td>
                            <td data-field="mat3_app">Garde-corps, d√©tails architecturaux</td>
                        </tr>
                        <tr>
                            <td><strong data-field="mat4_cat">Verre</strong></td>
                            <td data-field="mat4_mat">Double vitrage faible √©missivit√©</td>
                            <td data-field="mat4_app">Baies vitr√©es, ascenseur panoramique</td>
                        </tr>
                        <tr>
                            <td><strong data-field="mat5_cat">Enduits</strong></td>
                            <td data-field="mat5_mat">Tadelakt, chaux naturelle</td>
                            <td data-field="mat5_app">Fa√ßades, espaces wellness</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>R√©f√©rence Inspirationnelle</h4>
            
            <div class="info-box">
                <h5 data-field="ref_title">H√¥tel Xaluca Aguelmame Sidi Ali</h5>
                <p data-field="ref_desc">Ce lodge de montagne au Moyen Atlas illustre l'int√©gration r√©ussie d'une architecture contemporaine dans un environnement naturel marocain. Son approche du luxe discret, son utilisation de mat√©riaux locaux et son respect du paysage constituent des r√©f√©rences cl√©s pour TACHTA.</p>
                <p><em>Voir : https://maps.app.goo.gl/sBAmGGjTMyzMb5mx7</em></p>
            </div>

            <h4>Durabilit√© & Performance Environnementale</h4>
            
            <p data-field="section4_para6">Le projet doit int√©grer d√®s sa conception les principes de construction durable : orientation bioclimatique, isolation thermique renforc√©e, r√©cup√©ration des eaux pluviales, panneaux solaires thermiques pour l'eau chaude, et ventilation naturelle optimis√©e. Une certification environnementale (type HQE ou √©quivalent local) est vis√©e.</p>
        </section>

        <!-- Section 5: Interior Design -->
        <section id="interior-design">
            <span class="section-number">Section 05</span>
            <h2 data-field="section5_title">Concept Interior Design</h2>

            <h3 data-field="section5_h3_1">Direction Artistique Globale</h3>
            
            <p data-field="section5_para1">L'interior design prolonge la philosophie architecturale : un luxe nordique chaleureux o√π chaque espace raconte l'histoire de Ouazzane. L'objectif est de cr√©er des int√©rieurs qui respirent la s√©r√©nit√© tout en offrant un confort absolu.</p>

            <h4>Palette Chromatique</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Tonalit√©</th>
                            <th>Couleurs</th>
                            <th>Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong data-field="color1_ton">Neutres chauds</strong></td>
                            <td data-field="color1_col">Blanc cass√©, beige, gr√®ge, sable</td>
                            <td data-field="color1_use">Murs, plafonds, base mobilier</td>
                        </tr>
                        <tr>
                            <td><strong data-field="color2_ton">Terres</strong></td>
                            <td data-field="color2_col">Terracotta douce, ocre, caramel</td>
                            <td data-field="color2_use">Accentuation, textiles, c√©ramiques</td>
                        </tr>
                        <tr>
                            <td><strong data-field="color3_ton">Naturels</strong></td>
                            <td data-field="color3_col">Vert sauge, bleu de F√®s (subtil)</td>
                            <td data-field="color3_use">Touches v√©g√©tales, d√©tails artisanaux</td>
                        </tr>
                        <tr>
                            <td><strong data-field="color4_ton">M√©talliques</strong></td>
                            <td data-field="color4_col">Laiton dor√©, bronze patin√©</td>
                            <td data-field="color4_use">Luminaires, accessoires, robinetterie</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 data-field="section5_h3_2">Ambiances par Espace</h3>

            <h4 data-field="espace1_title">Lobby & R√©ception</h4>
            <p data-field="espace1_desc">Premier contact avec l'univers TACHTA. L'espace doit incarner l'accueil marocain dans une interpr√©tation contemporaine : double hauteur g√©n√©reuse, chemin√©e centrale sculpturale, mur v√©g√©tal ou installation artistique faisant r√©f√©rence au paysage environnant. Mobilier bas et accueillant, √©clairage travaill√© cr√©ant des √Ælots d'intimit√©.</p>

            <h4 data-field="espace2_title">Restaurant & Lounge Bar</h4>
            <p data-field="espace2_desc">Ambiance de table d'h√¥tes raffin√©e. Cuisine ouverte sur la salle (show cooking), terrasse prolongeant l'espace int√©rieur avec vue panoramique. Bar comme sculpture centrale. Acoustique soign√©e permettant des conversations intimes. √âclairage modulable selon les moments de la journ√©e.</p>

            <h4 data-field="espace3_title">SPA & Wellness</h4>
            <p data-field="espace3_desc">Sanctuaire de s√©r√©nit√©. Inspiration hammam r√©interpr√©t√©e avec lignes √©pur√©es. Tadelakt authentique, zelliges contemporains, jeux de lumi√®re tamis√©e. Parcours sensoriel : hammam, bain froid, salles de soins, espace d√©tente avec vue sur la nature. Parfum signature TACHTA diffus√©.</p>

            <h4 data-field="espace4_title">Chambres & Suites</h4>
            <p data-field="espace4_desc">Cocons de confort o√π chaque d√©tail compte. T√™te de lit monumentale en mat√©riau noble, literie d'exception, dressing fonctionnel, salle de bain ouverte (option) avec baignoire √Ælot face √† la vue. Minibar dissimul√©, √©clairage de lecture int√©gr√©, rideaux motoris√©s. Terrasse ou balcon privatif syst√©matique.</p>

            <h4 data-field="espace5_title">Appartements RIA</h4>
            <p data-field="espace5_desc">D√©clinaison r√©sidentielle de l'esprit h√¥telier. Livr√©s enti√®rement meubl√©s et √©quip√©s selon un cahier des charges uniforme garantissant la coh√©rence de l'ensemble et la qualit√© locative. Cuisine √©quip√©e haut de gamme, rangements optimis√©s, finitions identiques √† l'h√¥tel.</p>

            <h4 data-field="espace6_title">Salle √âv√©nementielle / Ballroom</h4>
            <p data-field="espace6_desc">Espace polyvalent de 300 m¬≤ divisible. Plafond technique permettant suspensions et √©clairages sc√©niques. Acoustique optimis√©e, syst√®me audiovisuel int√©gr√©. Acc√®s direct ext√©rieur et liaison cuisine. Vestiaires et sanitaires d√©di√©s.</p>

            <h3 data-field="section5_h3_3">Artisanat & Savoir-faire Local</h3>
            
            <p data-field="section5_para2">Le projet doit int√©grer de mani√®re significative l'artisanat de Ouazzane et de la r√©gion : tapis et tissages du Rif, poteries, fer forg√©, broderies. Ces √©l√©ments ne doivent pas appara√Ætre comme d√©coratifs mais comme constitutifs de l'identit√© des espaces, dans un dialogue permanent entre tradition et modernit√©.</p>

            <h4>√âclairage</h4>
            <p data-field="section5_para3">L'√©clairage est trait√© comme un mat√©riau √† part enti√®re. Luminaires sur mesure inspir√©s des lanternes traditionnelles, √©clairage indirect architectural, mise en valeur des textures et mat√©riaux. Sc√©narios programmables adapt√©s aux usages (accueil, travail, d√©tente, d√Æner, nuit).</p>

            <h4>Mobilier</h4>
            <p data-field="section5_para4">Pi√®ces iconiques de designers contemporains (scandinaves notamment) associ√©es √† des cr√©ations sur mesure d'artisans locaux. √âquilibre entre confort absolu, fonctionnalit√© et esth√©tique. Privil√©gier les mat√©riaux durables et les fabrications √©thiques.</p>
        </section>

        <!-- Section 6: Exigences Techniques -->
        <section id="exigences-techniques">
            <span class="section-number">Section 06</span>
            <h2 data-field="section6_title">Exigences Techniques</h2>

            <h3 data-field="section6_h3_1">Conformit√© R√©glementaire</h3>
            
            <p data-field="section6_para1">Le projet doit r√©pondre int√©gralement aux normes de classement h√¥telier 5 √©toiles luxe et aux exigences du cadre RIA (R√©sidences Immobili√®res Adoss√©es) tel que d√©fini par l'Arr√™t√© n¬∞ 836-24.</p>

            <div class="info-box">
                <h5>11 Th√©matiques Normatives RIA</h5>
                <p data-field="section6_normes">La conformit√© aux normes de classement RIA couvre 11 th√©matiques obligatoires que l'architecte devra int√©grer d√®s la phase conception : ext√©rieurs et signal√©tique, hall et r√©ception, chambres et suites, restauration, √©quipements de loisirs, services, d√©veloppement durable, accessibilit√©, s√©curit√©, gestion qualit√©, et personnel.</p>
            </div>

            <h4>Accessibilit√© PMR</h4>
            
            <p data-field="section6_para2">Conformit√© totale aux normes d'accessibilit√© pour les personnes √† mobilit√© r√©duite : 5% minimum des chambres adapt√©es PMR, accessibilit√© de l'ensemble des espaces communs, signal√©tique adapt√©e, √©quipements de piscine et spa accessibles.</p>

            <h4>Performance √ânerg√©tique</h4>

            <ul class="spec-list">
                <li>
                    <span class="spec-label" data-field="perf_label1">Isolation thermique</span>
                    <span class="spec-value" data-field="perf_value1">RT2012 √©quivalent ou sup√©rieur</span>
                </li>
                <li>
                    <span class="spec-label" data-field="perf_label2">Production eau chaude</span>
                    <span class="spec-value" data-field="perf_value2">60% solaire thermique minimum</span>
                </li>
                <li>
                    <span class="spec-label" data-field="perf_label3">Climatisation</span>
                    <span class="spec-value" data-field="perf_value3">VRV haute efficacit√©</span>
                </li>
                <li>
                    <span class="spec-label" data-field="perf_label4">√âclairage</span>
                    <span class="spec-value" data-field="perf_value4">100% LED, gestion automatis√©e</span>
                </li>
                <li>
                    <span class="spec-label" data-field="perf_label5">R√©cup√©ration eaux pluviales</span>
                    <span class="spec-value" data-field="perf_value5">Pour arrosage et sanitaires</span>
                </li>
            </ul>

            <h4>Domotique & Smart Building</h4>
            
            <p data-field="section6_para3">Syst√®me de gestion technique centralis√©e (GTC) pour l'ensemble du complexe. Dans les chambres et appartements : contr√¥le √©clairage, climatisation, rideaux, TV, room service via tablette ou smartphone. Serrures √©lectroniques, d√©tection de pr√©sence, gestion √©nerg√©tique intelligente.</p>

            <h4>S√©curit√©</h4>
            
            <p data-field="section6_para4">Syst√®me de s√©curit√© incendie (SSI) conforme, vid√©osurveillance p√©rim√©trique et des espaces communs, contr√¥le d'acc√®s, coffres-forts dans toutes les unit√©s, √©clairage de s√©curit√©, issues de secours conformes.</p>

            <h4>Acoustique</h4>
            
            <p data-field="section6_para5">Isolation acoustique entre unit√©s : 55 dB minimum. Traitement acoustique des espaces communs (restaurant, lobby, ballroom). √âquipements techniques silencieux et isol√©s.</p>
        </section>

        <!-- Section 7: Am√©nagements Ext√©rieurs -->
        <section id="amenagements-exterieurs">
            <span class="section-number">Section 07</span>
            <h2 data-field="section7_title">Am√©nagements Ext√©rieurs & Paysagers</h2>

            <h3 data-field="section7_h3_1">Paysagiste R√©f√©rent</h3>
            
            <div class="info-box">
                <h5 data-field="paysagiste_nom">Pascal LOPEZ ‚Äî ID Paysages</h5>
                <p data-field="paysagiste_desc">La conception paysag√®re sera confi√©e √† Pascal LOPEZ et son agence ID Paysages. La coordination √©troite entre l'architecte et le paysagiste est essentielle d√®s les phases amont pour garantir une int√©gration harmonieuse du b√¢ti dans son environnement.</p>
            </div>

            <h3 data-field="section7_h3_2">Programme des Am√©nagements Ext√©rieurs</h3>

            <h4>√âquipements Sportifs</h4>

            <ul class="spec-list">
                <li>
                    <span class="spec-label" data-field="sport_label1">Terrains de Padel</span>
                    <span class="spec-value" data-field="sport_value1">2 courts minimum</span>
                </li>
                <li>
                    <span class="spec-label" data-field="sport_label2">Circuit de jogging</span>
                    <span class="spec-value" data-field="sport_value2">Parcours balis√© dans la v√©g√©tation</span>
                </li>
                <li>
                    <span class="spec-label" data-field="sport_label3">Aire de jeux enfants</span>
                    <span class="spec-value" data-field="sport_value3">Espace s√©curis√©, √©quipements naturels</span>
                </li>
            </ul>

            <h4 data-field="section7_h4_1">Amphith√©√¢tre V√©g√©tal</h4>
            
            <p data-field="section7_para1">Un amphith√©√¢tre √† ciel ouvert, sculpt√© dans la pente naturelle et habill√© de v√©g√©tation, pouvant accueillir √©v√©nements culturels, concerts acoustiques, c√©r√©monies et rassemblements. Capacit√© indicative : 150-200 places.</p>

            <h4>Principes Paysagers</h4>
            
            <p data-field="section7_para2"><strong>V√©g√©tation :</strong> Palette v√©g√©tale m√©diterran√©enne et end√©mique n√©cessitant peu d'arrosage. Olivier centenaires pr√©serv√©s, agrumes, lavandes, romarins, gramin√©es ornementales. Pr√©servation maximale des arbres existants.</p>

            <p data-field="section7_para3"><strong>Circulations :</strong> Cheminements pi√©tons en mat√©riaux naturels (pierre, bois, stabilis√©) connectant l'ensemble des √©quipements. √âclairage discret int√©gr√©.</p>

            <p data-field="section7_para4"><strong>Gestion de l'eau :</strong> Noues paysag√®res, bassins de r√©tention naturalis√©s, irrigation goutte-√†-goutte automatis√©e.</p>

            <p data-field="section7_para5"><strong>Mobilier ext√©rieur :</strong> Bancs, pergolas, transats ‚Äî design coh√©rent avec l'architecture, mat√©riaux r√©sistants et √©l√©gants.</p>
        </section>

        <!-- Section 8: Planning & Livrables -->
        <section id="planning">
            <span class="section-number">Section 08</span>
            <h2 data-field="section8_title">Planning & Livrables Attendus</h2>

            <h3 data-field="section8_h3_1">Phases de Mission</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-phase" data-field="phase1_num">Phase 1</div>
                    <div class="timeline-title" data-field="phase1_title">Esquisse (ESQ)</div>
                    <div class="timeline-desc" data-field="phase1_desc">√âtudes pr√©liminaires, implantation g√©n√©rale, volum√©trie, premi√®res intentions architecturales et paysag√®res. Validation du concept avec le ma√Ætre d'ouvrage.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-phase" data-field="phase2_num">Phase 2</div>
                    <div class="timeline-title" data-field="phase2_title">Avant-Projet Sommaire (APS)</div>
                    <div class="timeline-desc" data-field="phase2_desc">Affinement du projet, plans masse, coupes g√©n√©rales, fa√ßades, premiers choix de mat√©riaux. Estimation budg√©taire pr√©liminaire.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-phase" data-field="phase3_num">Phase 3</div>
                    <div class="timeline-title" data-field="phase3_title">Avant-Projet D√©finitif (APD)</div>
                    <div class="timeline-desc" data-field="phase3_desc">Plans d√©taill√©s, carnets de d√©tails, fiches espaces, synth√®se technique. Dossier de demande de permis de construire.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-phase" data-field="phase4_num">Phase 4</div>
                    <div class="timeline-title" data-field="phase4_title">Projet (PRO) & DCE</div>
                    <div class="timeline-desc" data-field="phase4_desc">Documents d'ex√©cution, plans techniques tous corps d'√©tat, CCTP, quantitatifs. Consultation des entreprises.</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-phase" data-field="phase5_num">Phase 5</div>
                    <div class="timeline-title" data-field="phase5_title">Suivi de Chantier (DET/AOR)</div>
                    <div class="timeline-desc" data-field="phase5_desc">Direction de l'ex√©cution des travaux, visites de chantier, r√©ception des ouvrages.</div>
                </div>
            </div>

            <h3 data-field="section8_h3_2">Livrables Interior Design</h3>

            <ul class="spec-list">
                <li>
                    <span class="spec-label" data-field="livrable_label1">Moodboards & planches tendances</span>
                    <span class="spec-value" data-field="livrable_value1">Par typologie d'espace</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label2">Plans d'am√©nagement mobilier</span>
                    <span class="spec-value" data-field="livrable_value2">√âchelle 1/50</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label3">√âl√©vations int√©rieures</span>
                    <span class="spec-value" data-field="livrable_value3">Tous murs principaux</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label4">Carnets de d√©tails</span>
                    <span class="spec-value" data-field="livrable_value4">Menuiseries, agencements</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label5">Fiches produits</span>
                    <span class="spec-value" data-field="livrable_value5">Mobilier, luminaires, accessoires</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label6">Palettes mat√©riaux</span>
                    <span class="spec-value" data-field="livrable_value6">√âchantillons physiques</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label7">Rendus 3D photor√©alistes</span>
                    <span class="spec-value" data-field="livrable_value7">Espaces cl√©s</span>
                </li>
                <li>
                    <span class="spec-label" data-field="livrable_label8">Budgets estimatifs</span>
                    <span class="spec-value" data-field="livrable_value8">Par poste et par espace</span>
                </li>
            </ul>

            <h3>Formats de Rendu</h3>
            
            <p data-field="section8_para1">Plans et documents techniques : DWG + PDF. Rendus et pr√©sentations : PDF haute d√©finition + source (InDesign/Photoshop). Maquettes 3D : SketchUp/Revit + exports.</p>
        </section>

        <!-- Section 9: Annexes -->
        <section id="annexes">
            <span class="section-number">Section 09</span>
            <h2 data-field="section9_title">Annexes</h2>

            <h3 data-field="section9_h3_1">Documents de R√©f√©rence</h3>
            
            <p data-field="section9_para1">Les documents suivants sont mis √† disposition des prestataires et consultables sur demande aupr√®s du ma√Ætre d'ouvrage :</p>

            <ul class="spec-list">
                <li>
                    <span class="spec-label" data-field="doc_label1">Titre foncier</span>
                    <span class="spec-value" data-field="doc_value1">TF 30810/30 ‚Äî 7 639 m¬≤</span>
                </li>
                <li>
                    <span class="spec-label" data-field="doc_label2">Plan topographique</span>
                    <span class="spec-value" data-field="doc_value2">Relev√© g√©om√®tre</span>
                </li>
                <li>
                    <span class="spec-label" data-field="doc_label3">√âtude g√©otechnique</span>
                    <span class="spec-value" data-field="doc_value3">Rapport de sol</span>
                </li>
                <li>
                    <span class="spec-label" data-field="doc_label4">Permis de construire</span>
                    <span class="spec-value" data-field="doc_value4">Autorisation obtenue</span>
                </li>
                <li>
                    <span class="spec-label" data-field="doc_label5">Business Plan synth√©tique</span>
                    <span class="spec-value" data-field="doc_value5">bp.ouazzanehospitality.com</span>
                </li>
                <li>
                    <span class="spec-label" data-field="doc_label6">Contrat-programme</span>
                    <span class="spec-value" data-field="doc_value6">contrat.ouazzanehospitality.com</span>
                </li>
            </ul>

            <h3 data-field="section9_h3_2">Benchmarks Visuels</h3>
            
            <p data-field="section9_para2">Les r√©f√©rences visuelles ci-dessous illustrent l'esprit recherch√© et serviront de base aux √©changes avec les √©quipes de conception :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>R√©f√©rence</th>
                            <th>Pertinence</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong data-field="bench1_ref">H√¥tel Xaluca Aguelmame Sidi Ali</strong></td>
                            <td data-field="bench1_pert">Int√©gration paysag√®re, mat√©riaux locaux, luxe montagnard</td>
                        </tr>
                        <tr>
                            <td><strong data-field="bench2_ref">Alma Resort (Vietnam)</strong></td>
                            <td data-field="bench2_pert">Mod√®le RIA/RIPT, diversification produit, ratio √©quipements</td>
                        </tr>
                        <tr>
                            <td><strong data-field="bench3_ref">Four Seasons Marrakech</strong></td>
                            <td data-field="bench3_pert">Standards 5 √©toiles luxe, interpr√©tation contemporaine marocaine</td>
                        </tr>
                        <tr>
                            <td><strong data-field="bench4_ref">R√©f√©rences nordiques</strong></td>
                            <td data-field="bench4_pert">Atmosph√®res, mobilier, √©clairage, mat√©riaux</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 data-field="section9_h3_3">Contacts</h3>
            
            <div class="info-box">
                <h5>Ma√Ætre d'Ouvrage</h5>
                <p data-field="contact_societe"><strong>Ouazzane Hospitality SARL</strong></p>
                <p data-field="contact_associes">Repr√©sent√© par KEF Investissements (34%), Anass Tahiri (33%), Abdelmalik Hounain (33%)</p>
                <p data-field="contact_conseil">Conseil juridique : Ma√Ætre Mohamed Jalal Atitar</p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="document-footer">
            <div class="footer-logo">TACHTA</div>
            <p class="footer-text" data-field="footer_text">
                Cahier des Charges Architectural ‚Äî Version 1.0<br>
                ¬© 2026 Ouazzane Hospitality SARL ‚Äî Tous droits r√©serv√©s
            </p>
            <div class="confidential-badge">Document Confidentiel</div>
        </footer>

    </main>

    <script>
        // ========== CONFIGURATION ==========
        const EDIT_PASSWORD = 'OH1234';
        const FIREBASE_PATH = 'CdC OH';
        const DEBOUNCE_DELAY = 500;
        
        // Firebase Configuration (Hardcoded)
        const firebaseConfig = {
            apiKey: "AIzaSyCYIY1npF5lBb8uJ6Z_evETDMaDcnfl_5o",
            authDomain: "ouazzane-hospitality.firebaseapp.com",
            databaseURL: "https://ouazzane-hospitality-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ouazzane-hospitality",
            storageBucket: "ouazzane-hospitality.firebasestorage.app",
            messagingSenderId: "55074975436",
            appId: "1:55074975436:web:c1aad3f108ad0f9d491c69",
            measurementId: "G-GHE180GJHQ"
        };

        // State
        let db = null;
        let dataRef = null;
        let presenceRef = null;
        let isOnline = false;
        let isEditMode = false;
        let userId = null;
        let pendingChanges = [];
        let debounceTimers = {};
        let originalContent = {};

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            // Generate unique user ID
            userId = localStorage.getItem('cdc_userId') || generateUserId();
            localStorage.setItem('cdc_userId', userId);

            // Store original content for restoration
            storeOriginalContent();

            // Initialize Firebase
            initFirebase();

            // Setup editable fields (initially disabled)
            setupEditableFields();
        }

        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function storeOriginalContent() {
            document.querySelectorAll('[data-field]').forEach(el => {
                originalContent[el.dataset.field] = el.innerHTML;
            });
        }

        // ========== FIREBASE ==========
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                dataRef = db.ref(FIREBASE_PATH);
                presenceRef = db.ref(FIREBASE_PATH + '/presence');

                // Setup connection monitoring
                setupConnectionMonitoring();

                // Setup presence
                setupPresence();

                // Listen to data changes
                listenToChanges();

                // Listen to presence changes
                listenToPresence();

                updateConnectionStatus('online');
                showToast('‚úÖ Connect√© √† la base de donn√©es', 'success');
            } catch (error) {
                console.error('Firebase init error:', error);
                updateConnectionStatus('offline');
                showToast('‚ö†Ô∏è Mode hors-ligne activ√©', 'warning');
                loadFromLocalStorage();
            }
        }

        function setupConnectionMonitoring() {
            const connectedRef = db.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                if (snap.val() === true) {
                    isOnline = true;
                    updateConnectionStatus('online');
                    syncPendingChanges();
                } else {
                    isOnline = false;
                    updateConnectionStatus('offline');
                }
            });
        }

        function setupPresence() {
            const userPresenceRef = presenceRef.child(userId);
            
            userPresenceRef.onDisconnect().remove();
            
            userPresenceRef.set({
                online: true,
                lastSeen: firebase.database.ServerValue.TIMESTAMP,
                editMode: isEditMode
            });
        }

        function updatePresence() {
            if (!isOnline) return;
            const userPresenceRef = presenceRef.child(userId);
            userPresenceRef.update({
                editMode: isEditMode,
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            });
        }

        function listenToPresence() {
            presenceRef.on('value', (snap) => {
                const users = snap.val() || {};
                const count = Object.keys(users).length;
                document.getElementById('userCountText').textContent = count + ' en ligne';
            });
        }

        function listenToChanges() {
            dataRef.child('content').on('value', (snap) => {
                const data = snap.val();
                if (data) {
                    applyRemoteChanges(data);
                    updateLastSyncTime();
                }
            });

            // Listen for field-level editing indicators
            dataRef.child('editing').on('value', (snap) => {
                const editing = snap.val() || {};
                updateEditingIndicators(editing);
            });
        }

        function applyRemoteChanges(data) {
            Object.keys(data).forEach(field => {
                const el = document.querySelector(`[data-field="${field}"]`);
                if (el && el.innerHTML !== data[field]) {
                    el.innerHTML = sanitizeHTML(data[field]);
                }
            });
        }

        function updateEditingIndicators(editing) {
            // Remove all editing indicators first
            document.querySelectorAll('[data-field]').forEach(el => {
                el.classList.remove('remote-editing');
            });

            // Add indicators for fields being edited by others
            Object.keys(editing).forEach(field => {
                if (editing[field] && editing[field] !== userId) {
                    const el = document.querySelector(`[data-field="${field}"]`);
                    if (el) {
                        el.classList.add('remote-editing');
                    }
                }
            });
        }

        function syncToFirebase(field, value) {
            if (!isOnline) {
                // Queue for later sync
                pendingChanges.push({ field, value, timestamp: Date.now() });
                saveToLocalStorage();
                return;
            }

            updateConnectionStatus('syncing');
            
            dataRef.child('content').child(field).set(value)
                .then(() => {
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                })
                .catch((error) => {
                    console.error('Sync error:', error);
                    pendingChanges.push({ field, value, timestamp: Date.now() });
                    updateConnectionStatus('offline');
                });
        }

        function setFieldEditing(field, isEditing) {
            if (!isOnline) return;
            
            if (isEditing) {
                dataRef.child('editing').child(field).set(userId);
            } else {
                dataRef.child('editing').child(field).remove();
            }
        }

        function syncPendingChanges() {
            if (pendingChanges.length === 0) return;

            showToast('üîÑ Synchronisation des modifications en attente...', 'info');
            
            const changes = [...pendingChanges];
            pendingChanges = [];

            changes.forEach(change => {
                syncToFirebase(change.field, change.value);
            });
        }

        // ========== LOCAL STORAGE ==========
        function saveToLocalStorage() {
            const data = {};
            document.querySelectorAll('[data-field]').forEach(el => {
                data[el.dataset.field] = el.innerHTML;
            });
            localStorage.setItem('cdc_content', JSON.stringify(data));
            localStorage.setItem('cdc_pending', JSON.stringify(pendingChanges));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('cdc_content');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    applyRemoteChanges(data);
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                }
            }

            const pending = localStorage.getItem('cdc_pending');
            if (pending) {
                try {
                    pendingChanges = JSON.parse(pending);
                } catch (e) {
                    pendingChanges = [];
                }
            }
        }

        // ========== EDITING ==========
        function setupEditableFields() {
            document.querySelectorAll('[data-field]').forEach(el => {
                // Initially not editable
                el.contentEditable = 'false';

                el.addEventListener('focus', () => {
                    if (isEditMode) {
                        setFieldEditing(el.dataset.field, true);
                    }
                });

                el.addEventListener('blur', () => {
                    if (isEditMode) {
                        setFieldEditing(el.dataset.field, false);
                    }
                });

                el.addEventListener('input', () => {
                    if (isEditMode) {
                        debouncedSync(el.dataset.field, el.innerHTML);
                    }
                });
            });
        }

        function enableEditing() {
            document.querySelectorAll('[data-field]').forEach(el => {
                el.contentEditable = 'true';
            });
            document.body.classList.add('edit-mode');
            document.getElementById('editModeBadge').classList.add('active');
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('exitEditBtn').style.display = 'flex';
            document.getElementById('restoreBtn').style.display = 'flex';
            isEditMode = true;
            updatePresence();
        }

        function disableEditing() {
            document.querySelectorAll('[data-field]').forEach(el => {
                el.contentEditable = 'false';
                el.classList.remove('remote-editing');
            });
            document.body.classList.remove('edit-mode');
            document.getElementById('editModeBadge').classList.remove('active');
            document.getElementById('editBtn').style.display = 'flex';
            document.getElementById('exitEditBtn').style.display = 'none';
            document.getElementById('restoreBtn').style.display = 'none';
            isEditMode = false;
            updatePresence();

            // Clear all editing indicators
            if (isOnline) {
                dataRef.child('editing').remove();
            }
        }

        function debouncedSync(field, value) {
            if (debounceTimers[field]) {
                clearTimeout(debounceTimers[field]);
            }
            
            debounceTimers[field] = setTimeout(() => {
                syncToFirebase(field, value);
                delete debounceTimers[field];
            }, DEBOUNCE_DELAY);
        }

        // ========== PASSWORD MODAL ==========
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').classList.remove('error');
            document.getElementById('passwordError').classList.remove('visible');
            setTimeout(() => document.getElementById('passwordInput').focus(), 100);
        }

        function hidePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
        }

        function handlePasswordKeypress(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const password = input.value;

            if (password === EDIT_PASSWORD) {
                hidePasswordModal();
                enableEditing();
                showToast('‚úèÔ∏è Mode √©dition activ√©', 'success');
            } else {
                input.classList.add('error');
                document.getElementById('passwordError').classList.add('visible');
                input.value = '';
                input.focus();
            }
        }

        function exitEditMode() {
            disableEditing();
            showToast('üëÅÔ∏è Mode lecture activ√©', 'info');
        }

        // ========== RESTORE ==========
        function confirmRestore() {
            document.getElementById('restoreModal').classList.add('active');
        }

        function hideRestoreModal() {
            document.getElementById('restoreModal').classList.remove('active');
        }

        function restoreOriginalVersion() {
            hideRestoreModal();

            // Apply original content
            Object.keys(originalContent).forEach(field => {
                const el = document.querySelector(`[data-field="${field}"]`);
                if (el) {
                    el.innerHTML = originalContent[field];
                    syncToFirebase(field, originalContent[field]);
                }
            });

            showToast('üîÑ Version originale restaur√©e', 'success');
        }

        // ========== UI UPDATES ==========
        function updateConnectionStatus(status) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');

            dot.className = 'status-dot';
            
            switch (status) {
                case 'online':
                    dot.classList.add('online');
                    text.textContent = 'Connect√©';
                    break;
                case 'syncing':
                    dot.classList.add('syncing');
                    text.textContent = 'Synchronisation...';
                    break;
                case 'offline':
                    dot.classList.add('offline');
                    text.textContent = 'Hors ligne';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('lastSyncTime').textContent = timeStr;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ========== EXPORT ==========
        function downloadPDF() {
            showToast('üì• G√©n√©ration du PDF en cours...', 'info');

            const element = document.body;
            const opt = {
                margin: [10, 10, 10, 10],
                filename: 'Cahier-des-Charges-TACHTA.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait' 
                },
                pagebreak: { mode: 'avoid-all' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                showToast('‚úÖ PDF t√©l√©charg√©', 'success');
            });
        }

        function downloadHTML() {
            // Get current content
            const content = {};
            document.querySelectorAll('[data-field]').forEach(el => {
                content[el.dataset.field] = el.innerHTML;
            });

            // Clone the document
            const clone = document.documentElement.cloneNode(true);
            
            // Remove toolbar and modals from clone
            const elementsToRemove = clone.querySelectorAll('.toolbar, .modal-overlay, .toast-container, .sync-info');
            elementsToRemove.forEach(el => el.remove());

            // Create downloadable HTML
            const htmlContent = '<!DOCTYPE html>\n' + clone.outerHTML;
            
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Cahier-des-Charges-TACHTA.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('‚úÖ HTML t√©l√©charg√©', 'success');
        }

        // ========== SECURITY ==========
        function sanitizeHTML(html) {
            // Basic XSS protection - remove script tags and event handlers
            const temp = document.createElement('div');
            temp.innerHTML = html;
            
            // Remove script tags
            temp.querySelectorAll('script').forEach(el => el.remove());
            
            // Remove event handlers
            temp.querySelectorAll('*').forEach(el => {
                Array.from(el.attributes).forEach(attr => {
                    if (attr.name.startsWith('on')) {
                        el.removeAttribute(attr.name);
                    }
                });
            });
            
            return temp.innerHTML;
        }
    </script>

</body>
</html>
